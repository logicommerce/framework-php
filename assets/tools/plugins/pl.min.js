function SimpleCanvas(n,e,o,i,a){function u(){p=new Canvas(o,i,l)}function c(){p={},clearInterval(y)}function r(){p.draw();n.appendChild(p.draw())}function s(){_=!_}function f(n){_||(p.clean(),n(p)),requestAnimFrame(function(){f(n)})}function w(e){n.onclick=function(t){var o=[t.layerX-n.offsetLeft,t.layerY-n.offsetTop];e&&"function"==typeof e&&e(o)}}function d(n){document.onkeydown=function(e){k||(k=!0,n&&"function"==typeof n&&n(e.keyCode))}}function m(n){document.onkeyup=function(e){k=!1,n&&"function"==typeof n&&n(e.keyCode)}}function l(n){a&&window.console&&window.console.log&&window.console.log(n)}t=this,t.init=u,t.destroy=c,t.start=r,t.toggle_pause=s,t.set_draw_handler=f,t.set_mouseclick_handler=w,t.set_keydown_handler=d,t.set_keyup_handler=m;var p,y,k=!1,_=!1;u()}window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(n){window.setTimeout(n,1e3/60)}}();var simplecanvas_keymap={left:37,up:38,right:39,bottom:40,enter:13,space:32,esc:27,w:87,s:83,p:80};
function Canvas(e,r){function i(){d=document.createElement("CANVAS");var t=document.createAttribute("width");t.value=e[0];var i=document.createAttribute("height");i.value=e[1];var n=document.createAttribute("style");n.value="border:1px solid #ddd; background:"+r,d.setAttributeNode(t),d.setAttributeNode(i),d.setAttributeNode(n),u=d.getContext("2d")}function n(){d={}}function o(){return d}function a(){u.save(),u.setTransform(1,0,0,1,0,0),u.clearRect(0,0,d.width,d.height),u.restore()}function l(t,e,r,i,n){u.save(),u.font=(r?r:24)+"px "+(n?n:"Arial"),u.fillStyle=i?i:"white",u.fillText(t,e[0],e[1]),u.restore()}function c(t,e,r,i){u.save(),u.beginPath(),u.moveTo(t[0],t[1]),u.lineTo(e[0],e[1]),u.lineWidth=r?r:1,u.strokeStyle=i?i:"White",u.closePath(),u.stroke(),u.restore()}function s(t,e,r,i,n){u.save(),u.beginPath(),u.arc(t[0],t[1],e,0,2*Math.PI,!1),u.fillStyle=n?n:"white",u.lineWidth=r?r:1,u.strokeStyle=i?i:"White",u.closePath(),u.fill(),u.stroke(),u.restore()}t=this,t.init=i,t.destroy=n,t.draw=o,t.clean=a,t.draw_text=l,t.draw_line=c,t.draw_circle=s;var d,u;i()}
function ball_init(l){ball_pos=[WIDTH/2,HEIGHT/2],l?ball_dir_to_right=1:ball_dir_to_right=-1,ball_vel=[ball_dir_to_right*Math.floor(3*Math.random()+2),-1*Math.floor(3*Math.random()+1)]}function paddle_mod(l,a){return PAD_HEIGHT/2>l?(a=0,l=PAD_HEIGHT/2):l>HEIGHT-PAD_HEIGHT/2?(a=0,l=HEIGHT-PAD_HEIGHT/2):l+=a,paddle_pos_abs=[l-PAD_HEIGHT/2,l+PAD_HEIGHT/2],[l,a,paddle_pos_abs]}function new_game(){score1=0,score2=0,paddle1_pos=HEIGHT/2,paddle2_pos=HEIGHT/2,paddle1_vel=0,paddle2_vel=0,ball_init(Math.floor(2*Math.random()))}function draw(l){paddle1=paddle_mod(paddle1_pos,paddle1_vel),paddle1_pos=paddle1[0],paddle1_vel=paddle1[1],paddle1_pos_abs=paddle1[2],paddle2=paddle_mod(paddle2_pos,paddle2_vel),paddle2_pos=paddle2[0],paddle2_vel=paddle2[1],paddle2_pos_abs=paddle2[2],l.draw_line([HALF_PAD_WIDTH,paddle1_pos_abs[0]],[HALF_PAD_WIDTH,paddle1_pos_abs[1]],PAD_WIDTH,"White"),l.draw_line([WIDTH-HALF_PAD_WIDTH,paddle2_pos_abs[0]],[WIDTH-HALF_PAD_WIDTH,paddle2_pos_abs[1]],PAD_WIDTH,"White"),l.draw_line([WIDTH/2,0],[WIDTH/2,HEIGHT],1,"White"),l.draw_line([PAD_WIDTH,0],[PAD_WIDTH,HEIGHT],1,"White"),l.draw_line([WIDTH-PAD_WIDTH,0],[WIDTH-PAD_WIDTH,HEIGHT],1,"White"),ball_pos[0]+=ball_vel[0],ball_pos[1]+=ball_vel[1],(ball_pos[1]-2<=BALL_RADIUS||ball_pos[1]+2>=HEIGHT-BALL_RADIUS)&&(ball_vel[1]=-ball_vel[1]),ball_pos[0]<=BALL_RADIUS+PAD_WIDTH?(ball_vel[0]=1.1*-ball_vel[0],ball_vel[1]=ball_vel[1]+.02*(ball_pos[1]-paddle1_pos_abs[0]-40),(ball_pos[1]-2<=paddle1_pos_abs[0]||ball_pos[1]+2>=paddle1_pos_abs[1])&&(ball_init(!0),score2+=1)):ball_pos[0]>=WIDTH-BALL_RADIUS-PAD_WIDTH&&(ball_vel[0]=1.1*-ball_vel[0],ball_vel[1]=ball_vel[1]+.02*(ball_pos[1]-paddle2_pos_abs[0]-40),(ball_pos[1]<=paddle2_pos_abs[0]||ball_pos[1]>=paddle2_pos_abs[1])&&(ball_init(!1),score1+=1)),l.draw_circle(ball_pos,BALL_RADIUS,1,"White","White"),l.draw_text(score1,[160,80],48,"White","monospace"),l.draw_text(score2,[400,80],48,"White","monospace")}function click(l){return!0}function key_down(l){simplecanvas_keymap.up==l?paddle2_vel=-constant_paddle_vel:simplecanvas_keymap.bottom==l&&(paddle2_vel=constant_paddle_vel),simplecanvas_keymap.w==l?paddle1_vel=-constant_paddle_vel:simplecanvas_keymap.s==l&&(paddle1_vel=constant_paddle_vel)}function key_up(l){(simplecanvas_keymap.up==l||simplecanvas_keymap.bottom==l)&&(paddle2_vel=0),(simplecanvas_keymap.w==l||simplecanvas_keymap.s==l)&&(paddle1_vel=0),simplecanvas_keymap.space==l&&new_game(),simplecanvas_keymap.p==l&&frame.toggle_pause()}function pongInit(){var l=document.getElementById("pongcv");frame=new SimpleCanvas(l,"Hello canvas",[WIDTH,HEIGHT],"Black",false),frame.set_draw_handler(draw),frame.set_mouseclick_handler(click),frame.set_keydown_handler(key_down),frame.set_keyup_handler(key_up),frame.start(),new_game()}var frame,WIDTH=600,HEIGHT=400,BALL_RADIUS=20,PAD_WIDTH=8,PAD_HEIGHT=80,HALF_PAD_WIDTH=PAD_WIDTH/2,HALF_PAD_HEIGHT=PAD_HEIGHT/2,constant_paddle_vel=6,ball_pos=[0,0],ball_vel=[0,0],paddle1_pos=0,paddle2_pos=0,paddle1_vel=0,paddle2_vel=0,score1=0,score2=0;pongInit();